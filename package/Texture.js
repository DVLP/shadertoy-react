"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.RepeatWrapping=exports.MirroredRepeatWrapping=exports.ClampToEdgeWrapping=exports.LinearMipMapLinearFilter=exports.NearestMipMapLinearFilter=exports.LinearMipMapNearestFilter=exports.NearestMipMapNearestFilter=exports.LinearFilter=exports.NearestFilter=void 0;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}var NearestFilter=9728;exports.NearestFilter=NearestFilter;var LinearFilter=9729;exports.LinearFilter=LinearFilter;var NearestMipMapNearestFilter=9984;exports.NearestMipMapNearestFilter=NearestMipMapNearestFilter;var LinearMipMapNearestFilter=9985;exports.LinearMipMapNearestFilter=LinearMipMapNearestFilter;var NearestMipMapLinearFilter=9986;exports.NearestMipMapLinearFilter=NearestMipMapLinearFilter;var LinearMipMapLinearFilter=9987;exports.LinearMipMapLinearFilter=LinearMipMapLinearFilter;var ClampToEdgeWrapping=33071;exports.ClampToEdgeWrapping=ClampToEdgeWrapping;var MirroredRepeatWrapping=33648;exports.MirroredRepeatWrapping=MirroredRepeatWrapping;var RepeatWrapping=10497;// eslint-disable-next-line
exports.RepeatWrapping=RepeatWrapping;var isPowerOf2=function isPowerOf2(value){return(value&value-1)==0;};var floorPowerOfTwo=function floorPowerOfTwo(value){return Math.pow(2,Math.floor(Math.log(value)/Math.LN2));};var textureNeedsGenerateMipmaps=function textureNeedsGenerateMipmaps(texture,isPowerOfTwo){return isPowerOfTwo&&texture.minFilter!==NearestFilter&&texture.minFilter!==LinearFilter;};var textureNeedsPowerOfTwo=function textureNeedsPowerOfTwo(texture){if(texture.wrapS!==ClampToEdgeWrapping||texture.wrapT!==ClampToEdgeWrapping)return true;if(texture.minFilter!==NearestFilter&&texture.minFilter!==LinearFilter)return true;return false;};var Texture=function Texture(_gl){var _this=this;_classCallCheck(this,Texture);_defineProperty(this,"isLoaded",false);_defineProperty(this,"url",void 0);_defineProperty(this,"wrapS",void 0);_defineProperty(this,"wrapT",void 0);_defineProperty(this,"minFilter",void 0);_defineProperty(this,"magFilter",void 0);_defineProperty(this,"source",void 0);_defineProperty(this,"flipY",-1);_defineProperty(this,"width",0);_defineProperty(this,"height",0);_defineProperty(this,"_webglTexture",null);_defineProperty(this,"updateTexture",function(texture,video,flipY){var gl=_this.gl;var level=0;var internalFormat=gl.RGBA;var srcFormat=gl.RGBA;var srcType=gl.UNSIGNED_BYTE;gl.bindTexture(gl.TEXTURE_2D,texture);gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,flipY);gl.texImage2D(gl.TEXTURE_2D,level,internalFormat,srcFormat,srcType,video);});_defineProperty(this,"setupVideo",function(url){var video=document.createElement('video');var playing=false;var timeupdate=false;video.autoplay=true;video.muted=true;video.loop=true;video.crossOrigin='anonymous';var checkReady=function checkReady(){if(playing&&timeupdate){_this.isLoaded=true;}};video.addEventListener('playing',function(){playing=true;_this.width=video.videoWidth||0;_this.height=video.videoHeight||0;checkReady();},true);video.addEventListener('timeupdate',function(){timeupdate=true;checkReady();},true);video.src=url;// video.play();
return video;});_defineProperty(this,"makePowerOfTwo",function(image){if(image instanceof HTMLImageElement||image instanceof HTMLCanvasElement||image instanceof ImageBitmap){if(_this.pow2canvas===undefined)_this.pow2canvas=document.createElement('canvas');_this.pow2canvas.width=floorPowerOfTwo(image.width);_this.pow2canvas.height=floorPowerOfTwo(image.height);var context=_this.pow2canvas.getContext('2d');context.drawImage(image,0,0,_this.pow2canvas.width,_this.pow2canvas.height);// eslint-disable-next-line
console.warn("ShadertoyReact: Image is not power of two ".concat(image.width," x ").concat(image.height,". Resized to ").concat(_this.pow2canvas.width," x ").concat(_this.pow2canvas.height));return _this.pow2canvas;}return image;});_defineProperty(this,"load",function(textureArgs,channelId){var gl=_this.gl;var url=textureArgs.url,wrapS=textureArgs.wrapS,wrapT=textureArgs.wrapT,minFilter=textureArgs.minFilter,magFilter=textureArgs.magFilter,_textureArgs$flipY=textureArgs.flipY,flipY=_textureArgs$flipY===void 0?-1:_textureArgs$flipY;_this.url=url;_this.wrapS=wrapS;_this.wrapT=wrapT;_this.minFilter=minFilter;_this.magFilter=magFilter;_this.flipY=flipY;if(isImage===null&&isVideo===null){console.error('ShadertoyReact: Missing url, please make sure to pass the url of your texture { url: ... }');return;}var isImage=/(\.jpg|\.jpeg|\.png|\.gif|\.bmp)$/i.exec(url);var isVideo=/(\.mp4|\.3gp|\.webm|\.ogv)$/i.exec(url);if(isImage===null&&isVideo===null){console.error('ShadertoyReact: please upload a video or an image with a valid format',url);return;}var texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,texture);var level=0;var internalFormat=gl.RGBA;var width=1;var height=1;var border=0;var srcFormat=gl.RGBA;var srcType=gl.UNSIGNED_BYTE;var pixel=new Uint8Array([255,255,255,0]);gl.texImage2D(gl.TEXTURE_2D,level,internalFormat,width,height,border,srcFormat,srcType,pixel);if(isVideo){var video=_this.setupVideo(url);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);_this._webglTexture=texture;_this.source=video;_this.isVideo=true;return video.play().then(function(){return _this;});}return new Promise(function(resolve,reject){var image=new Image();image.crossOrigin='anonymous';image.onload=function(){return resolve(image);};image.onerror=function(){return reject(new Error("failed loading url: ".concat(url)));};image.src=url;}).then(function(image){var isPowerOfTwoImage=isPowerOf2(image.width)&&isPowerOf2(image.height);if(textureNeedsPowerOfTwo(textureArgs)&&isPowerOfTwoImage===false){image=_this.makePowerOfTwo(image);isPowerOfTwoImage=true;}gl.bindTexture(gl.TEXTURE_2D,texture);gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,flipY);gl.texImage2D(gl.TEXTURE_2D,level,internalFormat,srcFormat,srcType,image);if(textureNeedsGenerateMipmaps(textureArgs,isPowerOfTwoImage)){gl.generateMipmap(gl.TEXTURE_2D);}_this._webglTexture=texture;_this.source=image;_this.isVideo=false;_this.isLoaded=true;_this.width=image.width||0;_this.height=image.height||0;return _this;});});this.gl=_gl;};exports.default=Texture;